<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Fit models</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Peanut Smut Spore Dispersal Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="data_import.html">
    <span class="fas fa-table"></span>
     
    Data Import
  </a>
</li>
<li>
  <a href="data_viz.html">
    <span class="fas fa-chart-area"></span>
     
    Data Visualization
  </a>
</li>
<li>
  <a href="model.html">
    <span class="fas fa-file-code"></span>
     
    Model Fitting
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/juanchiem/peanut_smut_aerial">
    <span class="fa fa-github-square"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Fit models</h1>

</div>


<div id="load-libraries" class="section level2">
<h2>Load libraries</h2>
<pre class="r"><code>library(&quot;tidyverse&quot;)
library(&quot;broom&quot;)
library(&quot;ggplot2&quot;)
library(&quot;ggpubr&quot;)
library(&quot;gratia&quot;)
library(&quot;here&quot;)
library(&quot;mgcv&quot;)

theme_set(theme_pubclean())</code></pre>
</div>
<div id="load-data" class="section level2">
<h2>Load data</h2>
<pre class="r"><code>load(here(&quot;data/mod_dat.Rdata&quot;))</code></pre>
</div>
<div id="inspect-the-mod_dat-object" class="section level2">
<h2>Inspect the mod_dat object</h2>
<pre class="r"><code>mod_dat %&gt;%
  distinct(field, trap_coord, .keep_all = TRUE) %&gt;%
  select(trap_coord,
         trap_degrees,
         wind_degrees,
         degree_dif,
         downwind,
         trap_id) %&gt;%
  print(n = Inf)</code></pre>
<pre><code>## # A tibble: 24 × 6
##    trap_coord trap_degrees wind_degrees degree_dif downwind trap_id 
##    &lt;chr&gt;             &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;fct&gt;   
##  1 N                     0        76.2      76.2   lateral  1_N_100 
##  2 E                    90        76.2      13.8   upwind   1_E_100 
##  3 W                   270        76.2     194.    downwind 1_W_100 
##  4 S                   180        76.2     104.    lateral  1_S_100 
##  5 N                     0       201.      201.    downwind 2_N_100 
##  6 E                    90       201.      111.    lateral  2_E_100 
##  7 W                   270       201.       68.7   lateral  2_W_100 
##  8 S                   180       201.       21.3   upwind   2_S_100 
##  9 NE                   45       135.       90.3   lateral  3_NE_100
## 10 SE                  135       135.        0.313 upwind   3_SE_100
## 11 NW                  315       135.      180.    downwind 3_NW_100
## 12 SW                  225       135.       89.7   lateral  3_SW_100
## 13 N                     0        35.9      35.9   lateral  4_N_100 
## 14 E                    90        35.9      54.1   lateral  4_E_100 
## 15 W                   270        35.9     234.    lateral  4_W_100 
## 16 S                   180        35.9     144.    lateral  4_S_100 
## 17 NE                   45        29.9      15.1   upwind   5_NE_100
## 18 SE                  135        29.9     105.    lateral  5_SE_100
## 19 NW                  315        29.9     285.    lateral  5_NW_100
## 20 SW                  225        29.9     195.    downwind 5_SW_100
## 21 N                     0         2.16      2.16  upwind   6_N_100 
## 22 E                    90         2.16     87.8   lateral  6_E_100 
## 23 W                   270         2.16    268.    lateral  6_W_100 
## 24 S                   180         2.16    178.    downwind 6_S_100</code></pre>
<p>Because of the number of zeros in the data, we will use a <a href="https://en.wikipedia.org/wiki/Tweedie_distribution">Tweedie family</a> for the models to help account for this, <em>i.e.</em> in the model functions you will see <code>family = "tw"</code> for this.</p>
<div id="model-m1" class="section level3">
<h3>Model m1</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_slice</code>, <code>distance_m</code>, <code>downwind</code></li>
<li>Smoothed predictors: <code>wind_speed</code></li>
<li>Random effects: <code>trap_id</code></li>
</ul>
<pre class="r"><code>m1 &lt;- gam(
  spore_cm2 ~ time_slice + distance_m + downwind +
    s(wind_speed, k = 18) +
    s(trap_id, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m1</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.475) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ time_slice + distance_m + downwind + s(wind_speed, 
##     k = 18) + s(trap_id, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
##  4.37 80.67  total = 90.04 
## 
## REML score: 689.657</code></pre>
</div>
<div id="model-m2" class="section level3">
<h3>Model m2</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_slice</code>, <code>distance_m</code>, <code>downwind</code></li>
<li>Smoothed predictors: <code>wind_speed</code></li>
<li>Random effects: <code>trap_id</code>, <code>field</code></li>
</ul>
<pre class="r"><code>m2 &lt;- gam(
  spore_cm2 ~ time_slice + distance_m + downwind +
    s(wind_speed, k = 18) +
    s(trap_id, bs = &quot;re&quot;) +
    s(field, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m2</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.475) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ time_slice + distance_m + downwind + s(wind_speed, 
##     k = 18) + s(trap_id, bs = &quot;re&quot;) + s(field, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
##  3.85 79.00  1.98  total = 89.83 
## 
## REML score: 689.3324</code></pre>
</div>
<div id="model-m3" class="section level3">
<h3>Model m3</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_slice</code>, <code>distance_m</code>, <code>downwind</code></li>
<li>Smoothed predictors: <code>wind_speed</code></li>
<li>Random effects: <code>trap_id</code>, <code>time_slice</code></li>
</ul>
<pre class="r"><code>m3 &lt;- gam(
  spore_cm2 ~ time_slice + distance_m + downwind +
    s(wind_speed, k = 18) +
    s(trap_id, bs = &quot;re&quot;) +
    s(time_slice, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m3</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.475) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ time_slice + distance_m + downwind + s(wind_speed, 
##     k = 18) + s(trap_id, bs = &quot;re&quot;) + s(time_slice, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
##  4.37 80.67  0.00  total = 90.04 
## 
## REML score: 689.657</code></pre>
</div>
<div id="model-m4" class="section level3">
<h3>Model m4</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>distance_m</code>, <code>downwind</code></li>
<li>Smoothed predictors: <code>wind_speed</code></li>
<li>Random effects: <code>trap_id</code>, <code>time_slice</code></li>
</ul>
<pre class="r"><code>m4 &lt;- gam(
  spore_cm2 ~ distance_m + downwind +
    s(wind_speed, k = 18) +
    s(trap_id, bs = &quot;re&quot;) +
    s(time_slice, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m4</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.474) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ distance_m + downwind + s(wind_speed, k = 18) + s(trap_id, 
##     bs = &quot;re&quot;) + s(time_slice, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
##  4.41 80.74  0.96  total = 90.11 
## 
## REML score: 685.3865</code></pre>
</div>
</div>
<div id="model-aic" class="section level2">
<h2>Model AIC</h2>
<p>Check models for best fit using AIC.</p>
<pre class="r"><code>models &lt;- list(
  m1 = m1,
  m2 = m2,
  m3 = m3,
  m4 = m4
)
map_df(models, glance, .id = &quot;model&quot;) %&gt;%
  arrange(AIC, BIC)</code></pre>
<pre><code>## # A tibble: 4 × 8
##   model    df logLik   AIC   BIC deviance df.residual  nobs
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt; &lt;int&gt;
## 1 m4     90.1  -516. 1220. 1563.     219.        198.   288
## 2 m3     90.0  -517. 1220. 1563.     219.        198.   288
## 3 m1     90.0  -517. 1220. 1563.     219.        198.   288
## 4 m2     89.8  -517. 1222. 1567.     219.        198.   288</code></pre>
<p>Based on the AIC and BIC values, model m4 looks to be the best model for our data.</p>
</div>
<div id="inspect-model-m4" class="section level2">
<h2>Inspect Model m4</h2>
<div id="check-model" class="section level3">
<h3>Check model</h3>
<pre class="r"><code>gam.check(m4)</code></pre>
<p><img src="model_files/figure-html/gam-check-m4-1.png" width="672" /></p>
<pre><code>## 
## Method: REML   Optimizer: outer newton
## full convergence after 9 iterations.
## Gradient range [-3.087292e-06,2.71586e-06]
## (score 685.3865 &amp; scale 0.9118151).
## Hessian positive definite, eigenvalue range [0.4573097,222.8259].
## Model rank =  118 / 118 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                  k&#39;   edf k-index p-value
## s(wind_speed) 17.00  4.41    0.89    0.20
## s(trap_id)    96.00 80.74      NA      NA
## s(time_slice)  1.00  0.96    0.92    0.39</code></pre>
<p>The model fully converged after 9 iterations. All of the predictive factors included were significant at <em>P</em> &gt; 0.05 and the smoothed predictors indicate a good fit with residuals being randomly distributed and enough basis functions for them to be properly fit. The Q-Q plot generally falls along the line indicating a sufficient fit. There is a bit of a pattern in the residual vs linear predictors but the histogram of residuals is a nice bell-shape. The response versus fitted values clusters nicely around the 1:1 line. In all, this model looks to explain the spore dispersal data very well.</p>
</div>
<div id="summarise-and-visualise-model-m4" class="section level3">
<h3>Summarise and visualise model m4</h3>
<pre class="r"><code>summary(m4)</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.474) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ distance_m + downwind + s(wind_speed, k = 18) + s(trap_id, 
##     bs = &quot;re&quot;) + s(time_slice, bs = &quot;re&quot;)
## 
## Parametric coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      1.914362   0.425451   4.500 1.16e-05 ***
## distance_m      -0.003621   0.001391  -2.602  0.00997 ** 
## downwindlateral -0.931353   0.227389  -4.096 6.13e-05 ***
## downwindupwind  -1.679618   0.382786  -4.388 1.86e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                   edf Ref.df      F  p-value    
## s(wind_speed)  4.4084  5.226  3.684  0.00211 ** 
## s(trap_id)    80.7418 94.000  8.398  &lt; 2e-16 ***
## s(time_slice)  0.9601  1.000 38.124 7.74e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.889   Deviance explained = 90.5%
## -REML = 685.39  Scale est. = 0.91182   n = 288</code></pre>
<pre class="r"><code>plot(m4)</code></pre>
<p><img src="model_files/figure-html/appraise-m4-1.png" width="672" /><img src="model_files/figure-html/appraise-m4-2.png" width="672" /><img src="model_files/figure-html/appraise-m4-3.png" width="672" /></p>
</div>
</div>
<div id="predict-spore-dispersal" class="section level2">
<h2>Predict spore dispersal</h2>
<pre class="r"><code>newd &lt;- expand_grid(
  time_slice = c(90, 180, 270),
  downwind = c(&quot;downwind&quot;, &quot;lateral&quot;, &quot;upwind&quot;),
  distance_m = seq(0, 400, 100),
  wind_speed = 0:30,
  field = 1,
  trap_id = as.factor(apply(expand.grid(
    1, c(&quot;_N_&quot;, &quot;_S_&quot;, &quot;_E_&quot;, &quot;_W_&quot;), c(100, 200, 300, 400)
  ),
  1, paste, collapse = &quot;&quot;)),
  sub_sample = as.factor(c(1, 2))
)
  
newd$pred_spore_cm2 &lt;- predict(m4, newd)</code></pre>
</div>
<div id="visualise-spore-dispersal-predictions" class="section level2">
<h2>Visualise spore dispersal predictions</h2>
<p>Visualise the spore dispersal predictions for 0m, 100m, 200m, 300m, 400m for traps placed upwind, lateral and downwind of the harvest field for sampling times at 90, 180 and 270 minutes after harvest started.</p>
<pre class="r"><code>newd %&gt;%
  mutate(pred_spore_cm2 = replace(pred_spore_cm2, pred_spore_cm2 &lt; 0, 0)) %&gt;%
  ggplot(aes(x = as.factor(distance_m), y = pred_spore_cm2)) +
  geom_violin() +
  facet_grid(. ~ downwind) +
  labs(x = &quot;Distance from harvesting field (m)&quot;,
       y = &quot;Predicted Spores / m²&quot;
  )</code></pre>
<p><img src="model_files/figure-html/graph-predictions-1.png" width="672" /></p>
<pre class="r"><code>ggsave(
  last_plot(),
  file = &quot;plots/spore_prediction.png&quot;,
  w = 5,
  h = 2,
  scale = 1.2
)</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
