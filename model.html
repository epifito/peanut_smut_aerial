<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Fit models</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Peanut Smut Spore Dispersal Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="data_viz.html">
    <span class="fas fa-chart-area"></span>
     
    Data Visualization
  </a>
</li>
<li>
  <a href="model.html">
    <span class="fas fa-file-code-o"></span>
     
    Model Fitting
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/juanchiem/peanut_smut_aerial">
    <span class="fa fa-github-square"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Fit models</h1>

</div>


<div id="load-libraries" class="section level2">
<h2>Load libraries</h2>
<pre class="r"><code>library(&quot;tidyverse&quot;)
library(&quot;broom&quot;)
library(&quot;ggplot2&quot;)
library(&quot;ggpubr&quot;)
library(&quot;gratia&quot;)
library(&quot;here&quot;)
library(&quot;mgcv&quot;)

theme_set(theme_pubclean())</code></pre>
</div>
<div id="load-data" class="section level2">
<h2>Load data</h2>
<pre class="r"><code>load(here(&quot;data/dat.Rdata&quot;))
load(here(&quot;data/mod_dat.Rdata&quot;))

# add a factor col for the spore traps in each field respectively
mod_dat$trap_id &lt;-
  as.factor(paste0(mod_dat$field, mod_dat$trap_coord, mod_dat$distance_m))
mod_dat$sub_sample &lt;- as.factor(mod_dat$sub_sample)</code></pre>
</div>
<div id="inspect-the-mod_dat-object" class="section level2">
<h2>Inspect the mod_dat object</h2>
<pre class="r"><code>mod_dat %&gt;%
  distinct(field, trap_coord, .keep_all = TRUE) %&gt;%
  select(trap_coord,
         trap_degrees,
         wind_dir,
         wind_degrees,
         degree_dif,
         downwind,
         trap_id) %&gt;%
  print(n = Inf)</code></pre>
<pre><code>## # A tibble: 24 × 7
##    trap_coord trap_degrees wind_dir wind_degrees degree_dif downwind trap_id
##    &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  
##  1 E                    90 NE                 45         45 lateral  1E100  
##  2 N                     0 NE                 45         45 lateral  1N100  
##  3 S                   180 NE                 45        135 lateral  1S100  
##  4 W                   270 NE                 45        225 lateral  1W100  
##  5 E                    90 S                 180         90 lateral  2E100  
##  6 N                     0 S                 180        180 downwind 2N100  
##  7 S                   180 S                 180          0 upwind   2S100  
##  8 W                   270 S                 180         90 lateral  2W100  
##  9 NE                   45 SE                135         90 lateral  3NE100 
## 10 NW                  315 SE                135        180 downwind 3NW100 
## 11 SE                  135 SE                135          0 upwind   3SE100 
## 12 SW                  225 SE                135         90 lateral  3SW100 
## 13 E                    90 NE                 45         45 lateral  4E100  
## 14 N                     0 NE                 45         45 lateral  4N100  
## 15 S                   180 NE                 45        135 lateral  4S100  
## 16 W                   270 NE                 45        225 lateral  4W100  
## 17 NE                   45 NE                 45          0 upwind   5NE100 
## 18 NW                  315 NE                 45        270 lateral  5NW100 
## 19 SE                  135 NE                 45         90 lateral  5SE100 
## 20 SW                  225 NE                 45        180 downwind 5SW100 
## 21 E                    90 N                   0         90 lateral  6E100  
## 22 N                     0 N                   0          0 upwind   6N100  
## 23 S                   180 N                   0        180 downwind 6S100  
## 24 W                   270 N                   0        270 lateral  6W100</code></pre>
<p>Because of the number of zeros in the data, we will use a <a href="https://en.wikipedia.org/wiki/Tweedie_distribution">Tweedie family</a> for the models to help account for this, <em>i.e.</em> in the model functions you will see <code>family =  "tw"</code> for this.</p>
<div id="model-m1" class="section level3">
<h3>Model m1</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>distance_m:time_min</code></li>
<li>Random effects: <code>field</code></li>
</ul>
<pre class="r"><code>m1 &lt;- gam(
  spore_cm2 ~ distance_m:time_min +
    s(field, bs = &quot;re&quot;),
  data = mod_dat,
  method = &quot;REML&quot;,
  family = &quot;tw&quot;
)
m1</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.711) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ distance_m:time_min + s(field, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
## 4.72  total = 6.72 
## 
## REML score: 1722.582</code></pre>
</div>
<div id="model-m2" class="section level3">
<h3>Model m2</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>distance_m:time_min</code></li>
<li>Smoothed predictors: <code>downwind</code></li>
<li>Random effects: <code>field</code></li>
</ul>
<pre class="r"><code>m2 &lt;- gam(
  spore_cm2 ~ distance_m:time_min +
    s(field, bs = &quot;re&quot;) +
    s(downwind, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m2</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.627) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ distance_m:time_min + s(field, bs = &quot;re&quot;) + s(downwind, 
##     bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
## 4.63 1.99  total = 8.62 
## 
## REML score: 1591.738</code></pre>
</div>
<div id="model-m3" class="section level3">
<h3>Model m3</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>distance_m:time_min</code></li>
<li>Random effects: <code>field</code>, <code>downwind</code>, <code>wind_speed</code></li>
</ul>
<pre class="r"><code>m3 &lt;- gam(
  spore_cm2 ~ distance_m:time_min +
    s(wind_speed, bs = &quot;re&quot;) +
    s(field, bs = &quot;re&quot;) +
    s(downwind, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m3</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.627) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ distance_m:time_min + s(wind_speed, bs = &quot;re&quot;) + 
##     s(field, bs = &quot;re&quot;) + s(downwind, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
## 0.00 4.63 1.99  total = 8.62 
## 
## REML score: 1591.738</code></pre>
</div>
<div id="model-m4" class="section level3">
<h3>Model m4</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_min</code>, <code>downwind</code>, <code>wind_speed</code></li>
<li>Smoothed predictors: <code>distance_m</code></li>
<li>Random effects: <code>field</code></li>
</ul>
<pre class="r"><code>m4 &lt;- gam(
  spore_cm2 ~ time_min + downwind + wind_speed +
    s(distance_m, k = 3) +
    s(field, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m4</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.604) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ time_min + downwind + wind_speed + s(distance_m, 
##     k = 3) + s(field, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
## 1.00 3.46  total = 9.46 
## 
## REML score: 1549.849</code></pre>
</div>
<div id="model-m5" class="section level3">
<h3>Model m5</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_min</code>, <code>downwind</code>, <code>wind_speed</code></li>
<li>Smoothed predictors: <code>distance_m</code></li>
<li>Random effects: <code>field</code>, <code>time_min</code></li>
</ul>
<pre class="r"><code>m5 &lt;- gam(
  spore_cm2 ~ time_min + downwind + wind_speed +
    s(distance_m, k = 3) +
    s(time_min, bs = &quot;re&quot;) +
    s(field, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m5</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.604) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ time_min + downwind + wind_speed + s(distance_m, 
##     k = 3) + s(time_min, bs = &quot;re&quot;) + s(field, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
## 1.00 0.00 3.46  total = 9.46 
## 
## REML score: 1549.849</code></pre>
</div>
<div id="model-m6" class="section level3">
<h3>Model m6</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_min</code>, <code>downwind</code></li>
<li>Smoothed predictors: <code>distance_m</code></li>
<li>Random effects: <code>field</code></li>
</ul>
<pre class="r"><code>m6 &lt;- gam(
  spore_cm2 ~ time_min + downwind + s(distance_m, k = 3) +
    s(field, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m6</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.603) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ time_min + downwind + s(distance_m, k = 3) + s(field, 
##     bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
## 1.00 4.59  total = 9.59 
## 
## REML score: 1548.587</code></pre>
</div>
<div id="model-m7" class="section level3">
<h3>Model m7</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_min</code>, <code>distance_m</code>, <code>downwind</code></li>
<li>Random effects: <code>field</code></li>
</ul>
<pre class="r"><code>m7 &lt;- gam(
  spore_cm2 ~ time_min + distance_m + downwind + s(field, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m7</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.603) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ time_min + distance_m + downwind + s(field, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
## 4.59  total = 9.59 
## 
## REML score: 1553.303</code></pre>
</div>
<div id="model-m8" class="section level3">
<h3>Model m8</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_min</code>, <code>distance_m</code>, <code>downwind</code></li>
<li>Smoothed predictors: <code>wind_speed</code></li>
<li>Random effects: <code>field</code></li>
</ul>
<pre class="r"><code>m8 &lt;- gam(
  spore_cm2 ~ distance_m + downwind + time_min +
    s(wind_speed, k = 6) +
    s(field, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m8</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.605) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ distance_m + downwind + time_min + s(wind_speed, 
##     k = 6) + s(field, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
## 1.64 2.77  total = 9.41 
## 
## REML score: 1552.389</code></pre>
</div>
<div id="model-m9" class="section level3">
<h3>Model m9</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_min</code>, <code>distance_m</code>, <code>downwind</code>, <code>smut_incidence</code></li>
<li>Smoothed predictors: <code>wind_speed</code></li>
<li>Random effects: <code>field</code></li>
</ul>
<pre class="r"><code>m9 &lt;- gam(
  spore_cm2 ~ distance_m + downwind + time_min + `smut_incidence` +
    s(wind_speed, k = 6) +
    s(field, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m9</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.605) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ distance_m + downwind + time_min + smut_incidence + 
##     s(wind_speed, k = 6) + s(field, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
## 1.00 2.35  total = 9.35 
## 
## REML score: 1553.366</code></pre>
</div>
<div id="model-m10" class="section level3">
<h3>Model m10</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_min</code>, <code>distance_m</code>, <code>downwind</code>, <code>smut_incidence</code></li>
<li>Smoothed predictors: <code>wind_speed</code></li>
<li>Random effects: <code>trap_id</code>, <code>sub_sample</code></li>
</ul>
<pre class="r"><code>m10 &lt;- gam(
  spore_cm2 ~ time_min + distance_m + downwind +
    s(wind_speed, k = 6, by = downwind) +
    s(trap_id, sub_sample, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m10</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.393) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ time_min + distance_m + downwind + s(wind_speed, 
##     k = 6, by = downwind) + s(trap_id, sub_sample, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
##   2.24   3.64   1.43 134.72  total = 147.03 
## 
## REML score: 1393.691</code></pre>
</div>
<div id="model-m11" class="section level3">
<h3>Model m11</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_min</code>, <code>distance_m</code>, <code>downwind</code>, <code>smut_incidence</code></li>
<li>Smoothed predictors: <code>wind_speed</code></li>
<li>Random effects: <code>trap_id</code> and <code>sub_sample</code> grouped by <code>trap_id</code></li>
</ul>
<pre class="r"><code>m11 &lt;- gam(
  spore_cm2 ~ time_min + distance_m + downwind +
    s(wind_speed, k = 6) +
    s(trap_id, bs = &quot;re&quot;) +
    s(sub_sample, by = trap_id, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m11</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.381) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ time_min + distance_m + downwind + s(wind_speed, 
##     k = 6) + s(trap_id, bs = &quot;re&quot;) + s(sub_sample, by = trap_id, 
##     bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
##  1.0001 74.1731  0.9014  0.0002  1.6014  0.0000  0.0000 
##  0.0000  1.6557  0.0000  0.0000  0.0000  0.0000  0.0000 
##  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0027 
##  0.0000  0.0000  0.0000  0.0000  0.0000  1.2552  0.0000 
##  0.0000  0.0000  1.4896  0.0000  0.0001  0.0000  0.0000 
##  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000 
##  0.1876  0.0000  1.5149  0.1474  0.0000  0.0000  0.0000 
##  0.0000  1.6977  1.6097  0.0000  0.0000  0.0000  0.0000 
##  0.0000  0.0000  0.0000  0.0000  0.0808  0.0000  0.0000 
##  0.0000  0.0000  0.0000  0.0000  0.0000  0.1838  0.0000 
##  0.7639  0.0001  1.5124  0.0000  0.0000  0.1483  0.0001 
##  0.2474  0.0000  0.0001  0.0000  0.0155  0.0000  0.0000 
##  0.9699  0.0000  0.0000  0.0000  0.0000  0.0001  0.0000 
##  0.0000  0.5290  0.4666  0.0000  1.3752  0.0000  0.0000 
##  total = 98.53 
## 
## REML score: 1318.147</code></pre>
</div>
<div id="model-m12" class="section level3">
<h3>Model m12</h3>
<ul>
<li>Response: <code>spore_cm2</code></li>
<li>Linear predictors: <code>time_min</code>, <code>distance_m</code>, <code>downwind</code>, <code>smut_incidence</code></li>
<li>Smoothed predictors: <code>wind_speed</code></li>
<li>Random effects: <code>trap_id</code>, <code>sub_sample</code></li>
</ul>
<pre class="r"><code>m12 &lt;- gam(
  spore_cm2 ~ time_min + distance_m + downwind +
    s(wind_speed, k = 6) +
    s(trap_id, bs = &quot;re&quot;) +
    s(sub_sample, bs = &quot;re&quot;),
  method = &quot;REML&quot;,
  data = mod_dat,
  family = &quot;tw&quot;
)
m12</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.374) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ time_min + distance_m + downwind + s(wind_speed, 
##     k = 6) + s(trap_id, bs = &quot;re&quot;) + s(sub_sample, bs = &quot;re&quot;)
## 
## Estimated degrees of freedom:
##  1.001 80.881  0.247  total = 87.13 
## 
## REML score: 1322.293</code></pre>
</div>
</div>
<div id="model-aic" class="section level2">
<h2>Model AIC</h2>
<p>Check models for best fit using AIC.</p>
<pre class="r"><code>models &lt;- list(
  m1 = m1,
  m2 = m2,
  m3 = m3,
  m4 = m4,
  m5 = m5,
  m6 = m6,
  m7 = m7,
  m8 = m8,
  m9 = m9,
  m10 = m10,
  m11 = m11,
  m12 = m12
)
map_df(models, glance, .id = &quot;model&quot;) %&gt;%
  arrange(AIC, BIC)</code></pre>
<pre><code>## # A tibble: 12 × 8
##    model     df logLik   AIC   BIC deviance df.residual  nobs
##    &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt; &lt;int&gt;
##  1 m12    87.1  -1146. 2475. 2872.     715.        489.   576
##  2 m11    98.5  -1129. 2481. 2969.     670.        477.   576
##  3 m10   147.   -1153. 2611. 3274.     714.        429.   576
##  4 m7      9.59 -1528. 3079. 3130.    2097.        566.   576
##  5 m6      9.59 -1528. 3079. 3131.    2097.        566.   576
##  6 m9      9.35 -1528. 3079. 3131.    2097.        567.   576
##  7 m4      9.46 -1528. 3079. 3131.    2097.        567.   576
##  8 m5      9.46 -1528. 3079. 3131.    2097.        567.   576
##  9 m8      9.41 -1528. 3079. 3131.    2097.        567.   576
## 10 m2      8.62 -1562. 3147. 3194.    2295.        567.   576
## 11 m3      8.62 -1562. 3147. 3194.    2295.        567.   576
## 12 m1      6.72 -1699. 3416. 3455.    3265.        569.   576</code></pre>
<p>Based on the AIC and BIC values, model m12 looks to be the best model for our data.</p>
</div>
<div id="inspect-model-m12" class="section level2">
<h2>Inspect Model m12</h2>
<div id="check-model" class="section level3">
<h3>Check model</h3>
<pre class="r"><code>gam.check(m12)</code></pre>
<p><img src="model_files/figure-html/gam-check-m12-1.png" width="672" /></p>
<pre><code>## 
## Method: REML   Optimizer: outer newton
## full convergence after 5 iterations.
## Gradient range [-8.526417e-05,5.676235e-05]
## (score 1322.293 &amp; scale 1.3313).
## Hessian positive definite, eigenvalue range [3.634049e-05,460.3881].
## Model rank =  108 / 108 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##                   k&#39;    edf k-index p-value  
## s(wind_speed)  5.000  1.001    0.85    0.02 *
## s(trap_id)    96.000 80.881      NA      NA  
## s(sub_sample)  2.000  0.247      NA      NA  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The model did fully converge after 5 iterations but wind speed is residuals are not randomly distributed. The diagnostic plots show some issues with the fit, indicating that we really need more data to fit a proper model if we were interested in fully predicting spore dispersal, but for our purposes, explaining the dispersal, this model is good enough. However, in the future, collecting more data so that <code>k</code> could be increased would be useful, but since this is the data that we have, this appears to be the best model that describes it.</p>
</div>
<div id="summarise-model" class="section level3">
<h3>Summarise model</h3>
<pre class="r"><code>summary(m12)</code></pre>
<pre><code>## 
## Family: Tweedie(p=1.374) 
## Link function: log 
## 
## Formula:
## spore_cm2 ~ time_min + distance_m + downwind + s(wind_speed, 
##     k = 6) + s(trap_id, bs = &quot;re&quot;) + s(sub_sample, bs = &quot;re&quot;)
## 
## Parametric coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      3.4290693  0.4619755   7.423 5.13e-13 ***
## time_min         0.0036997  0.0003989   9.275  &lt; 2e-16 ***
## distance_m      -0.0036582  0.0012514  -2.923  0.00362 ** 
## downwindlateral -2.9509766  0.3809744  -7.746 5.52e-14 ***
## downwindupwind  -3.2338553  0.4784438  -6.759 3.97e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                   edf Ref.df      F p-value    
## s(wind_speed)  1.0007  1.001  8.534 0.00365 ** 
## s(trap_id)    80.8806 91.000 14.616 &lt; 2e-16 ***
## s(sub_sample)  0.2468  1.000  0.315 0.25945    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.821   Deviance explained = 87.6%
## -REML = 1322.3  Scale est. = 1.3313    n = 576</code></pre>
</div>
<div id="visualise-the-model" class="section level3">
<h3>Visualise the model</h3>
<pre class="r"><code>draw(m12)</code></pre>
<p><img src="model_files/figure-html/visualise-m12-1.png" width="672" /></p>
</div>
</div>
<div id="predict-spore-dispersal" class="section level2">
<h2>Predict spore dispersal</h2>
<pre class="r"><code>mod_dat %&gt;% distinct(downwind) %&gt;% pull()</code></pre>
<pre><code>## [1] lateral  downwind upwind  
## Levels: downwind lateral upwind</code></pre>
<pre class="r"><code>newd &lt;- expand_grid(
  time_min = c(90, 180, 270),
  downwind = c(&quot;downwind&quot;, &quot;lateral&quot;, &quot;upwind&quot;),
  distance_m = seq(0, 400, 100),
  wind_speed = 0:30,
  trap_id = as.factor(apply(expand.grid(
    1, c(&quot;N&quot;, &quot;S&quot;, &quot;E&quot;, &quot;W&quot;), c(100, 200, 300, 400)
  ),
  1, paste, collapse = &quot;&quot;)),
  sub_sample = as.factor(c(1, 2))
)
  
newd$pred_spore_cm2 &lt;- predict(m12, newd)</code></pre>
</div>
<div id="visualise-spore-dispersal-predictions" class="section level2">
<h2>Visualise spore dispersal predictions</h2>
<p>The GAM will predict spores to disperse at negative values, since this is not possible, we will set any values that are less than zero to zero in the model’s output before plotting.</p>
<pre class="r"><code>newd %&gt;%
  mutate(pred_spore_cm2 = replace(pred_spore_cm2, pred_spore_cm2 &lt; 0, 0)) %&gt;%
  ggplot(aes(x = distance_m, y = pred_spore_cm2, col = downwind)) +
  geom_smooth(method = &quot;gam&quot;, formula = y ~ s(x, k = 5), size = 1) +
  scale_fill_viridis_d(&quot;Prevailing wind&quot;) +
  scale_colour_viridis_d(&quot;Prevailing Wind&quot;) +
  facet_grid(. ~ time_min) +
  scale_x_continuous(sec.axis = sec_axis(
    ~ . ,
    name = &quot;Minutes since harvest beginning&quot;,
    breaks = NULL,
    labels = NULL
  )) +
  labs(x = &quot;Distance from harvesting field (m)&quot;,
       y = &quot;Spores / m²&quot;) +
  theme(
    legend.position = &quot;top&quot;,
    legend.justification = &quot;center&quot;,
    legend.direction = &quot;horizontal&quot;,
    legend.background = element_blank(),
    legend.key = element_blank()
  ) +
  guides(fill = guide_legend(title.position = &quot;top&quot;,
                             title.hjust = 0.5))</code></pre>
<div class="figure">
<img src="model_files/figure-html/graph-predictions-1.png" alt="Predictions of spore dispersal (spores per meter squared) at 0m to 400m for three time points, 90 min, 180 min, 270 min after peanut harvest commenced." width="672" />
<p class="caption">
Predictions of spore dispersal (spores per meter squared) at 0m to 400m for three time points, 90 min, 180 min, 270 min after peanut harvest commenced.
</p>
</div>
<pre class="r"><code>ggsave(
  last_plot(),
  file = &quot;plots/spore_prediction.png&quot;,
  w = 5,
  h = 2,
  scale = 1.2
)</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
